
# /etc/nginx/conf.d/custom.conf (mounted from ./nginx/custom.conf)

server {
  listen 80;
  server_name _;

  # --- React SPA at /app ---
  location /app {
    # Strip the /app prefix before forwarding to the SPAâ€™s nginx
    rewrite ^/app(/.*)$ $1 break;
    proxy_pass http://orthanc-react:80;

    proxy_set_header Host              $host;
    proxy_set_header X-Real-IP         $remote_addr;
    proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  # --- Pass-through for Orthanc REST at /orthanc/ ---
  # (mirrors the built-in image's reverse proxy so 404s don't happen if this server gets selected)
  location /orthanc/ {
    proxy_pass         http://orthanc:8042/;
    proxy_http_version 1.1;

    proxy_set_header Host              $host;
    proxy_set_header X-Real-IP         $remote_addr;
    proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # Optional: keep long requests stable for large uploads
    proxy_read_timeout  600s;
    proxy_send_timeout  600s;
  }

  # --- Pass-through for OHIF at /ohif/ ---
  location /ohif/ {
    proxy_pass         http://ohif:80/;
    proxy_http_version 1.1;

    proxy_set_header Host              $host;
    proxy_set_header X-Real-IP         $remote_addr;
    proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }
}
